\input{setup.tex}

\documentclass{article}
\usepackage{amsmath,unicode-math,physics,geometry}

\geometry{margin=1cm, showframe}
\unimathsetup{math-style=ISO, bold-style=ISO, mathrm=sym}

\setmainfont{TeX Gyre Pagella}
% \setsansfont{TeX Gyre Heros}
% \setmonofont{CMU Typewriter Text}[UprightFont=* Light, HyphenChar=None]

\ExplSyntaxOn
\str_new:N  \l_fonttest_font_str
\str_set:Nn \l_fonttest_font_str { fira }  % Can be either fira/xits

\str_if_eq:VnTF \l_fonttest_font_str { fira }
  {
    \clist_const:Nn \c__fonttest_weights_clist
      {
        Thin, UltraLight, ExtraLight, Light, Book, Regular,
        Medium, SemiBold, Bold, ExtraBold, Heavy, Ultra
      }
      % { Thin, Regular, Ultra }
      % {Regular}
    \clist_map_inline:Nn \c__fonttest_weights_clist
      { \setmathfont { FiraMath-#1.otf } [ Path = ../release/fonts/, version = #1 ] }
  }
  {
    \str_if_eq:VnT \l_fonttest_font_str { xits }
      {
        \clist_const:Nn \c__fonttest_weights_clist { Regular, Bold }
        \clist_map_inline:Nn \c__fonttest_weights_clist
          { \setmathfont { XITSMath-#1.otf } [ version = #1 ] }
      }
  }

\cs_new:Npn \WeightTest #1
  {
    \clist_map_inline:Nn \c__fonttest_weights_clist
      { \group_begin: \mathversion {##1} #1 \group_end: }
  }

\ExplSyntaxOff

\begin{document}

\WeightTest{
  \[
    \int_0^{+\infty}     f(x) \,\mathrm{d}x \,
    \iint_0^{+\infty}    f(x) \,\mathrm{d}x \,
    \iiint_0^{+\infty}   f(x) \,\mathrm{d}x \,
    \iiiint_0^{+\infty}  f(x) \,\mathrm{d}x \quad
    \oint_0^{+\infty}    f(x) \,\mathrm{d}x \,
    \oiint_0^{+\infty}   f(x) \,\mathrm{d}x \,
    \oiiint_0^{+\infty}  f(x) \,\mathrm{d}x
  \]}

\WeightTest{
  \[\begin{gathered}
      {f'}^{{f'}^{f'}} - {x''}^{{x''}^{x''}} + {F'''}^{{F'''}^{F'''}} - {H''''}^{{H''''}^{H''''}}
    + \frac{1}{2} + \frac{x}{y} - \frac{-b\pm\sqrt{b^2-4ac}}{2a} \\
    f'f^\prime f\prime + f''f^\dprime f\dprime + f'''f^\trprime f\trprime + f''''f^\qprime f\qprime \\
      f'(x)   + g'(x)   - F'(x)   + V'(y)   - L'(x) + f\prime g\dprime h\trprime k\qprime
    + f`(x)   + g`(x)   - F`(x)   + V`(y)   - L`(x) + f\backprime g\backdprime h\backtrprime \\
      f''(x)  + g''(x)  - F''(x)  + V''(y)  - L''(x)
    + f``(x)  + g``(x)  - F``(x)  + V``(y)  - L``(x) \\
      f'''(x) + g'''(x) - F'''(x) + V'''(y) - L'''(x)
    + f```(x) + g```(x) - F```(x) + V```(y) - L```(x)
  \end{gathered}\]}

\WeightTest{
  \[\begin{gathered}
    \int\limits_0^\infty \int_0^\infty
    \sum_{i=1}^\infty \prod_{j=i}^\infty \coprod_{k=i}^\infty \qquad
    \sum_{i=1}^\infty    \frac{1}{x^i} = \frac{1}{1-x} \quad
    \Bbbsum_{i=1}^\infty \frac{1}{x^i} = ?             \quad
    \prod_{i=1}^\infty   \frac{1}{x^i} = x^{-n(n+1)/2} \quad
    \coprod_{i=i}^\infty \frac{1}{x^i} = ?
  \end{gathered}\]}

\WeightTest{
  \[
    \textstyle
    \int\limits_0^\infty \int_0^\infty \iint \dd{x} \iiint \dd{y} \iiiint \dd{p}
    \oint \dd{r} \oiint \dd{\theta} \oiiint \dd{\varphi}
    \sum_{i=1}^\infty x^i \Bbbsum_{i=1}^\infty
    \prod_{j=\symbf{i}}^\infty \symbf{A}_j(p) \coprod_{k=j}^\infty f^{(k)}_j(x)
  \]}

\end{document}
